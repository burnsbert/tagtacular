/* Tagtacular 0.8.6 -- Copyright 2013 Eric Burns, MIT License: https://github.com/burnsbert/tagtacular/blob/master/license.txt */
!function(a){"use strict";a.fn.tagtacular=function(b){var c=this,d=[],e=[],f="edit",g="",h=0,i="",j="",k=function(b){b=L.formatTagName(a.trim(b));var c=L.validate(b,L);c===!0?s(b)?L.messageAddTagAlreadyExists&&L.flashFailure(L.messageAddTagAlreadyExists):(d.push(b),B(b,e)||(e.push(b),e=L.sort(e)),L.configSortTags&&(d=L.sort(d)),L.commitAddTag(b,L.entityId,L),p(),l(!0),L.messageAddTagSuccess&&L.flashSuccess(L.messageAddTagSuccess)):c&&L.flashFailure(c),t()},l=function(a,b){"edit"==f?m(a,b):"view"==f&&n(),j.length>0&&L.flashSuccess(j),i.length>0&&L.flashFailure(i),L.postDrawEditTray(f)},m=function(b,e){if(e=e||g||"",L.configSelectBox){var i='<select class="tagtacular_add_input">',j=u();i+='<option value=""></option>',a.each(j,function(a,b){i+='<option value="'+b+'">'+b+"</option>"}),i+="</select>"}else var h=L.configPlaceholderText?' placeholder="'+L.configPlaceholderText+'"':"",i='<input type="text" class="tagtacular_add_input"'+h+' value="'+e+'" />';L.configShowAddButton&&(i+=L.getAddButtonHtml(L)),L.configShowSwitchButton&&(i+=L.getSwitchButtonHtml(f,L)),L.configRenderFlashMessageSpan&&(i+='<span style="display: none;" class="tagtacular_flash"></span>'),c.find(".tagtacular_edit_tray").html(i),L.configShowAddButton&&c.find(".tagtacular_edit_tray .tagtacular_add_button").bind("click",function(a){a.preventDefault();var b=c.find(".tagtacular_edit_tray .tagtacular_add_input").val();L.configSelectBox&&b.length<1?L.messageEmptySelectBoxFailure&&L.flashFailure(L.messageEmptySelectBoxFailure):k(b)}),L.configShowSwitchButton&&c.find(".tagtacular_edit_tray .tagtacular_switch_button").bind("click",function(a){a.preventDefault();var b=c.find(".tagtacular_edit_tray .tagtacular_add_input").val();L.configAddOnSwitch&&b.length>=1&&k(b),g=c.find(".tagtacular_edit_tray .tagtacular_add_input").val(),f="view",p(),l(!0),L.postSwitchLayout(f)}),c.find(".tagtacular_edit_tray .tagtacular_add_input").bind("keydown",function(b){var e=c.find(".tagtacular_edit_tray .tagtacular_add_input").val();-1!=a.inArray(b.which,L.configDeleteLastOnEmptyKeys)&&e.length<1&&(b.preventDefault(),b.stopPropagation(),y(d[d.length-1]))}),c.find(".tagtacular_edit_tray .tagtacular_add_input").bind("keypress",function(b){if(-1!=a.inArray(b.which,L.configDelimiters)){b.preventDefault(),b.stopPropagation();var d=c.find(".tagtacular_edit_tray .tagtacular_add_input").val();d.length>0&&k(d)}}),!L.configSelectBox&&L.configAutocomplete&&c.find(".tagtacular_edit_tray .tagtacular_add_input").autocomplete({source:u(),select:function(a,b){c.find(".tagtacular_edit_tray .tagtacular_add_input").val(""),k(b.item.value)}}),b&&t()},n=function(){var a="";L.configShowSwitchButton&&L.configAllowedToEdit&&(a+=L.getSwitchButtonHtml(f,L)),L.configRenderFlashMessageSpan&&(a+='<span style="display: none;" class="tagtacular_flash"></span>'),c.find(".tagtacular_edit_tray").html(a),L.configShowSwitchButton&&L.configAllowedToEdit&&c.find(".tagtacular_edit_tray .tagtacular_switch_button").bind("click",function(a){a.preventDefault(),f="edit",p(),l(!0),g="",L.postSwitchLayout(f)})},o=function(){L.configAllowedToEdit||(f="view"),c.html(L.getLayoutHtml(L)),p(),l(!1)},p=function(){d=z(d),"edit"==f?q():"view"==f&&r(),L.postDrawTagList(f)},q=function(){var b=[];a.each(d,function(a,c){b.push(L.getTagHtml(c,f,L))});var e=b.join("");c.find(".tagtacular_tag_tray").html(e),c.find(".tagtacular_tag_tray .tagtacular_tag").last().find(".tagtacular_delim").remove(),c.find(".tagtacular_tag_tray .tagtacular_delete").bind("click",function(b){b.preventDefault();var c=a(this).closest(".tagtacular_tag"),d=c.find(".tagtacular_value").text();c.remove(),y(d)})},r=function(){var b=[];a.each(d,function(a,c){b.push(L.getTagHtml(c,f,L))});var e=b.join("");c.find(".tagtacular_tag_tray").html(e),c.find(".tagtacular_tag_tray .tagtacular_tag").last().find(".tagtacular_delim").remove()},s=function(a){return B(a,d)},t=function(){var a=c.find(".tagtacular_edit_tray .tagtacular_add_input"),b=a.val();a.focus().val("").val(b)},u=function(){return L.configAutocompletePrune?v():e},v=function(){var b=a.grep(e,function(b){return a.inArray(b,d)<0});return b},w=function(){var b=a.extend({},L);return b.entityTags=d,b.systemTags=e,b.mode=f,b.toplevel=c,b},x=function(b){var c=[];return a.each(b,function(b,d){-1==a.inArray(d,c)&&c.push(d)}),c},y=function(b){d=a.grep(d,function(a){return L.configCaseInsensitive?a.toUpperCase()!=b.toUpperCase():a!=b}),L.commitRemoveTag(b,L.entityId,L),p(),l(!0,c.find(".tagtacular_add_input").val()),L.messageRemoveTagSuccess&&L.flashSuccess(L.messageRemoveTagSuccess,"removeTag",b),t()},z=function(a){return L.configSortTags&&(a=L.sort(a)),a},B=function(b,c){var d=a.grep(c,function(a){return L.configCaseInsensitive?a.toUpperCase()==b.toUpperCase():a==b});return d.length>0},C=function(a){return a.sort(function(a,b){var a=a.toLowerCase(),b=b.toLowerCase();return a==b?0:a>b?1:-1}),a},D=function(a){i=a,j="";var b=c.find(".tagtacular_flash");b.html(a),b.addClass("tagtacular_failure"),b.removeClass("tagtacular_success"),b.show();var d=++h;L.configFlashFailureHideAfter&&setTimeout(function(){if(h==d){var a=c.find(".tagtacular_flash");i="",a.fadeOut()}},1e3*L.configFlashFailureHideAfter)},E=function(a){j=a,i="";var b=c.find(".tagtacular_flash");b.html(a),b.addClass("tagtacular_success"),b.removeClass("tagtacular_failure"),b.show();var d=++h;L.configFlashSuccessHideAfter&&setTimeout(function(){if(h==d){var a=c.find(".tagtacular_flash");j="",a.fadeOut()}},1e3*L.configFlashSuccessHideAfter)},F=function(a){return'<button class="tagtacular_add_button">'+a.configAddButtonText+"</button>"},G=function(a){return a.configEditTrayFirst?'<div class="tagtacular_edit_tray"></div><div class="tagtacular_tag_tray"></div>':'<div class="tagtacular_tag_tray"></div><div class="tagtacular_edit_tray"></div>'},H=function(a,b){var c="view"==a?b.configSwitchButtonTextInView:b.configSwitchButtonTextInEdit;return'<button class="tagtacular_switch_button">'+c+"</button>"},I=function(a,b,c){return"edit"==b?'<span class="tagtacular_tag tagtacular_tag_edit"><span class="tagtacular_value">'+a+'</span>&nbsp;<a class="tagtacular_delete" href="#">'+c.configDeleteSymbol+'</a><span class="tagtacular_delim">'+c.configTagSeparator+"</span></span>":"view"==b?'<span class="tagtacular_tag tagtacular_tag_view"><span class="tagtacular_value">'+a+'</span><span class="tagtacular_delim">'+c.configTagSeparator+"</span></span>":void 0},J=function(a,b){if(a.length<b.configMinimumTagLength)return b.messageTagTooShort;if(a.length>b.configMaximumTagLength)return b.messageTagTooLong;var c=b.validationPattern;return c.test(a)?!0:b.messageTagNameInvalid},K=function(a){return a},L={commitAddTag:K,commitRemoveTag:K,configAddOnSwitch:!0,configAddButtonText:"Add",configAllowedToEdit:!0,configAutocomplete:!0,configAutocompletePrune:!0,configCaseInsensitive:!0,configDeleteSymbol:"X",configDeleteLastOnEmptyKeys:[],configDelimiters:[13,44],configEditTrayFirst:!1,configFlashFailureHideAfter:5,configFlashSuccessHideAfter:5,configFormatTagNamesOnInit:!1,configMinimumTagLength:1,configMaximumTagLength:32,configPlaceholderText:!1,configRenderFlashMessageSpan:!0,configSelectBox:!1,configShowAddButton:!0,configShowSwitchButton:!0,configSortTags:!0,configSwitchButtonTextInEdit:"Done",configSwitchButtonTextInView:"Edit",configTagSeparator:"",entityId:null,entityType:null,entityTags:[],getAddButtonHtml:F,getLayoutHtml:G,getSwitchButtonHtml:H,getTagHtml:I,flashFailure:D,flashSuccess:E,formatTagName:K,messageAddTagSuccess:"tag added",messageAddTagAlreadyExists:"tag is already assigned",messageEmptySelectBoxFailure:"you must select a tag before adding it",messageRemoveTagSuccess:"tag removed",messageTagNameInvalid:"invalid tag name: tag names can only include letters, numbers, underscores, hyphens, and spaces",messageTagTooLong:"tag name too long, maximum length of [configMaximumTagLength]",messageTagTooShort:"tag name too short, minimum length of [configMinimumTagLength]",mode:"edit",postDrawEditTray:K,postDrawTagList:K,postSwitchLayout:K,sort:C,systemTags:[],validate:J,validationPattern:/^[0-9A-Za-z_\- ]+$/},M=function(b){return b=b||{},a.each(b,function(a,b){L[a]=b}),L.messageTagTooLong=L.messageTagTooLong.replace("[configMaximumTagLength]",L.configMaximumTagLength),L.messageTagTooShort=L.messageTagTooShort.replace("[configMinimumTagLength]",L.configMinimumTagLength),d=z(L.entityTags),e=L.systemTags.concat(d),e=L.sort(x(e)),L.configFormatTagNamesOnInit&&(d=a.map(d,function(a){return L.formatTagName(a)}),e=a.map(e,function(a){return L.formatTagName(a)})),f=L.mode,L.toplevel=c,o(),c};return a.extend(c,{addTag:k}),a.extend(c,{flashFailure:L.flashFailure}),a.extend(c,{flashSuccess:L.flashSuccess}),a.extend(c,{getEntityId:function(){return L.entityId}}),a.extend(c,{getEntityType:function(){return L.entityType}}),a.extend(c,{getEntityTags:function(){return d}}),a.extend(c,{getRemainingTags:v}),a.extend(c,{getState:w}),a.extend(c,{getSystemTags:function(){return e}}),a.extend(c,{removeTag:y}),a.extend(c,{tagtacular:M}),M(b)}}(jQuery);